@inject MainService mainService

<article>
    <header>
        <nav>
            <ul>
                <li>
                    @if(IsEdit)
                    {
                        <input @bind-value="@EditServer.Name" />
                    }
                    else
                    {
                        @(EditServer.Name)
                        <span> -</span>
                        <span class="@StatusColor" aria-busy="@(IsLoading ? "true" : "false")">
                            @(!IsValid ? "Invalid Hostname or IP" : IsLoading ? "Loading..." : IsOn ? "Online" : "Offline")
                        </span>
                    }
                </li>
            </ul>
            <ul>
                @if (IsEdit)
                {
                    <li><button type="button" @onclick="ClickSaveEdit">Save</button></li>
                }
                <li>
                    <button type="button" @onclick="ToggleEdit">
                        @if (!IsEdit)
                        {
                            <img width="24" src="/edit.png" />
                        }
                        else
                        {
                            <img width="24" src="/close.png" />
                        }
                    </button>
                </li>
            </ul>
        </nav>
    </header>
    <table>
        <tbody>
            <tr>
                <td>Host or IP</td>
                <td style="text-align: end;">
                    <input disabled="@(!IsEdit)" @bind-value="@EditServer.HostnameOrAddress" style="width: auto; height: 40px; margin:auto;" />
                </td>
            </tr>
            <tr>
                <td>Mac Address</td>
                <td style="text-align: end; margin: unset">
                    <input disabled="@(!IsEdit)" @bind-value="@EditServer.MacAddress" style="width: auto; height: 40px; margin:auto;" />
                </td>
            </tr>
        </tbody>
    </table>
    <footer>
        <button type="button" @onclick="SendWake" disabled="@(IsOn || IsLoading || !IsValid)">Wake Up</button>
    </footer>
</article>

@code {
    [Parameter]
    public required Server server { get; set; }

    [Parameter]
    public required string Name { get; set; }

    [Parameter]
    public required string HostnameOrAddress { get; set; }

    [Parameter]
    public required string MacAddress { get; set; }

    [Parameter]
    public required bool IsOn { get; set; }

    [Parameter]
    public bool IsLoading { get; set; } = true;

    [Parameter]
    public bool IsValid { get; set; } = true;

    [Parameter]
    public string StatusColor { get; set; } = "pico-color-blue-550";

    [Parameter]
    public Action? OnEditSaved { get; set; }

    private bool IsEdit { get; set; } = false;
    private Server EditServer = new()
    {
        Name = "",
        HostnameOrAddress = "",
        MacAddress = ""
    };

    protected override void OnInitialized()
    {
        base.OnInitialized();
        EditServer = server;
    }

    protected override void OnParametersSet()
    {
        StatusColor = !IsValid ? "pico-color-amber-350" : IsLoading ? "pico-color-blue-550" : IsOn ? "pico-color-jade-400" : "pico-color-red-550";
        EditServer = server;
    }

    private void ToggleEdit()
    {
        IsEdit = !IsEdit;
    }

    private void ClickSaveEdit()
    {
        server = EditServer;
        IsEdit = false;
        OnEditSaved?.Invoke();
    }

    public void Reload()
    {
        StateHasChanged();
    }

    async void SendWake()
    {
        await mainService.SendWake(server.MacAddress);
    }
}